<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boat Info</title>
</head>
<body>
    <h1>Select a Boat</h1>
    
    <!-- Boat Selector -->
    <select id="boatSelector">
        <option value="">Select a boat</option>
    </select>

    <!-- JSON File Selector -->
    <h2>Select Data File</h2>
    <select id="jsonSelector" disabled>
        <option value="">Select a file</option>
    </select>

    <!-- Display Data -->
    <div id="boatInfo"></div>

    <script>
        const repoUrl = "https://lukskul.github.io/Vessel-Mechanic-Log-V.2/DataFiles"; 
        const fileIndexUrl = `${repoUrl}/fileIndex.json`; // File that lists JSON files
        let boatsData = {}; // Store fetched file index
        
        const boatSelector = document.getElementById("boatSelector");
        const jsonSelector = document.getElementById("jsonSelector");
        const boatInfo = document.getElementById("boatInfo");

        // Fetch the file index
        fetch(fileIndexUrl)
            .then(response => response.json())
            .then(data => {
                boatsData = data; // Store JSON data
                populateBoatDropdown(Object.keys(boatsData));
            })
            .catch(error => console.error("Error loading file index:", error));

        // Populate the boat dropdown
        function populateBoatDropdown(boats) {
            boats.forEach(boat => {
                let option = document.createElement("option");
                option.value = boat;
                option.textContent = boat;
                boatSelector.appendChild(option);
            });
        }

        // Handle boat selection
        boatSelector.addEventListener("change", () => {
            jsonSelector.innerHTML = `<option value="">Select a file</option>`; // Reset file list
            boatInfo.innerHTML = ""; // Clear previous data

            const selectedBoat = boatSelector.value;
            if (selectedBoat && boatsData[selectedBoat]) {
                boatsData[selectedBoat].forEach(file => {
                    let option = document.createElement("option");
                    option.value = file;
                    option.textContent = file;
                    jsonSelector.appendChild(option);
                });
                jsonSelector.disabled = false;
            } else {
                jsonSelector.disabled = true;
            }
        });

        // Handle JSON file selection
        jsonSelector.addEventListener("change", () => {
            if (jsonSelector.value) {
                fetchBoatData(boatSelector.value, jsonSelector.value);
            } else {
                boatInfo.innerHTML = ""; // Clear display if no file selected
            }
        });

        // Fetch JSON data
        function fetchBoatData(boat, file) {
            const fileUrl = `${repoUrl}/${boat}/${file}`;  // Construct URL

            fetch(fileUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("File not found");
                    }
                    return response.json();
                })
                .then(data => {
                    boatInfo.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                })
                .catch(error => {
                    boatInfo.innerHTML = "<p>Error loading data.</p>";
                    console.error("Error fetching data:", error);
                });
        }
    </script>
</body>
</html>
